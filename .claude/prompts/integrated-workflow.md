# 整合工作流启动 Prompt

> Planning-with-Files + Superpowers 深度整合
> 支持：持久化 | 无人值守 | TDD | 子代理执行 | 会话恢复

---

## 使用方法

复制下方 prompt 到 Claude Code，替换 `{{任务描述}}` 后发送。

**快捷方式**：在 Claude Code 中使用 `/user:integrated-workflow`

---

## Prompt 正文

```
我需要你使用「整合工作流」来完成任务。

## 任务描述
{{任务描述}}

## 执行模式
{{选择一个: 正常模式 / 挂机模式}}

---

## 整合工作流规范

### 第一步：初始化

1. **执行 /planning-with-files**
   - 如果检测到之前的会话：显示恢复报告，确认继续点
   - 如果是新任务：创建 task_plan.md, findings.md, progress.md

2. **确认任务状态**
   - 新任务 → 进入设计阶段
   - 继续任务 → 跳到执行阶段，从未完成的 Task 继续

### 第二步：设计阶段（新任务）

使用 /brainstorming 的精简版：
1. 快速理解任务目标（1-2 个确认问题）
2. 提出技术方案（如有多个选择，给出推荐）
3. 输出写入 findings.md：
   ```markdown
   # {{功能名称}} 设计

   ## 目标
   一句话描述

   ## 技术方案
   - 关键决策 1
   - 关键决策 2

   ## 文件影响
   - 新增: ...
   - 修改: ...
   ```

### 第三步：计划阶段

使用 /writing-plans 格式，输出到 task_plan.md：

```markdown
# {{功能名称}} 实施计划

## 目标
{{一句话}}

## 设计文档
→ findings.md

## 当前任务
Task 1

---

## Tasks

### Task 1: {{任务标题}}
**状态:** pending
**文件:** {{具体路径}}

**TDD 步骤:**
1. [ ] 写失败测试
2. [ ] 确认测试失败
3. [ ] 写最小实现
4. [ ] 确认测试通过
5. [ ] 提交

---

### Task 2: ...
（重复格式）

---

## 错误记录
| 错误 | 任务 | 尝试 | 解决方案 |
|------|------|------|----------|
```

**任务粒度要求：**
- 每个 Task 应该 5-15 分钟可完成
- 每个 Task 有明确的验证标准
- Task 之间尽量独立

### 第四步：执行阶段

对每个 Task：

1. **派发子代理**
   ```
   Task tool with prompt:

   你正在执行: {{Task 标题}}

   上下文: {{从 findings.md 提取相关部分}}

   文件: {{具体路径}}

   TDD 要求（铁律）:
   - 必须先写测试
   - 必须看到测试失败
   - 必须写最小实现让测试通过
   - 违反则删除代码重来

   验证命令: {{pnpm test / pnpm lint / pnpm type-check}}

   完成后报告: 做了什么、测试结果、遇到的问题
   ```

2. **子代理完成后**
   - 更新 progress.md（记录执行日志）
   - 更新 task_plan.md（标记状态 completed）
   - 如有错误，记录到错误表

3. **继续下一个 Task**

### 第五步：完成验证

所有 Task 完成后：
1. 运行完整测试套件
2. 运行 lint 和 type-check
3. 结果写入 progress.md
4. 更新 task_plan.md 所有阶段为 completed

---

## 执行模式说明

### 正常模式
- 设计阶段会询问确认
- 遇到不确定的决策会询问
- 每个阶段完成后报告进度

### 挂机模式（无人值守）
**附加规则：**
1. 不使用 AskUserQuestion（用户已离开）
2. 遇到决策点：自主做合理选择，记录到 task_plan.md 的「自主决策」部分
3. 遇到阻塞（缺少信息/资源/权限）：
   - 将该 Task 状态改为 `suspended`
   - 在 task_plan.md 记录阻塞原因
   - 继续执行其他可独立完成的 Task
4. 优先完成能独立完成的部分
5. 所有可完成的 Task 完成后，输出总结报告

---

## 会话恢复

如果上下文满了需要 /clear：

1. 运行 `/clear`
2. 发送：`/planning-with-files 继续之前的任务`
3. 我会自动：
   - 读取 task_plan.md 恢复状态
   - 从未完成的 Task 继续执行
   - 保持之前的执行模式

---

## 文件更新时机

| 文件 | 更新时机 |
|------|----------|
| findings.md | 设计完成时、发现重要信息时 |
| task_plan.md | 每个 Task 状态变化时 |
| progress.md | 每个子代理执行完成后 |

---

现在开始执行整合工作流。
```

---

## 简化版（日常使用）

如果不需要完整流程，使用这个简化版：

```
使用整合工作流（简化版）完成任务：

{{任务描述}}

模式：{{正常/挂机}}

规则：
1. /planning-with-files 初始化
2. 快速设计 → findings.md
3. TDD 格式任务 → task_plan.md
4. 子代理执行，progress.md 记录
5. 挂机模式：不询问，自主决策，阻塞标记 suspended
```

---

## 恢复会话用

```
/planning-with-files

继续之前的整合工作流任务。
读取 task_plan.md 确认状态，从未完成的 Task 继续。
保持之前的执行模式。
```
